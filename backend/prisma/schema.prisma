// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int                @id @default(autoincrement())
  email        String             @unique
  username     String             @unique
  password     String
  createDate   DateTime           @default(now())
  isModerator Boolean @default(false)
  savedRecipes UserSavedRecipes[]
  recipes      Recipe[]
  userPosts    UserPosts[]
}

model Recipe {
  id                 Int                  @id @default(autoincrement())
  author             User                 @relation(fields: [authorID], references: [id])
  authorID           Int
  creationTime       DateTime             @default(now())
  recipeTitle        String
  description        String
  cookTimeHours      Int?
  cootTimeMinutes    Int
  calories           Int?
  servings           Int
  recipeIngredients  RecipeIngredients[]
  recipeInstructions RecipeInstructions[]
  recipeImage        String
  tags               RecipeTags[]
  usersSaved         UserSavedRecipes[]
}

model RecipeIngredients {
  id              Int    @id @default(autoincrement())
  recipeID        Int
  recipe          Recipe @relation(fields: [recipeID], references: [id])
  ingredient      String
  amount          Int
  measurementType String
}

model RecipeInstructions {
  id          Int    @id @default(autoincrement())
  recipeID    Int
  recipe      Recipe @relation(fields: [recipeID], references: [id])
  step        Int?
  instruction String
}

model RecipeTags {
  id     Int      @id @default(autoincrement())
  tag    String
  recipe Recipe[]
}

model UserSavedRecipes {
  userID    Int
  user      User     @relation(fields: [userID], references: [id])
  recipeID  Int
  recipe    Recipe   @relation(fields: [recipeID], references: [id])
  timeSaved DateTime @default(now())

  @@id([userID, recipeID])
}

model Posts {
  id            Int         @id @default(autoincrement())
  author        Int
  description   String
  tags          String
  image         String
  recipeURL     String
  creationTime  DateTime    @default(now())
  userPosts     UserPosts[]
  postTags      PostTags[]
}

model UserPosts {
  postID    Int     @unique
  author    Int
  userID    User    @relation(fields: [author], references: [id], onDelete: Cascade)
  post      Posts   @relation(fields: [postID], references: [id], onDelete: Cascade)
}

model PostTags {
  id        Int         @id @default(autoincrement())
  postID    Int
  tag       String
  postId    Posts       @relation(fields: [postID], references: [id], onDelete: Cascade)
}

